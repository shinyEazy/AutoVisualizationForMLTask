<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CSV Upload & Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center; /* center content */
      }
      #tableWrapper {
        max-width: 1280px;
        width: 100%;
        overflow-x: auto; /* horizontal scroll if table too wide */
        margin-top: 20px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        min-width: 600px; /* ensure structure */
      }
      table,
      th,
      td {
        border: 1px solid #aaa;
        padding: 8px;
        text-align: center;
        max-width: 200px; /* Prevent super wide cells */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      td {
        cursor: help; /* Show tooltip on hover */
      }
    </style>
  </head>
  <body>
    <input type="file" id="csvFile" accept=".csv" />
    <div id="tableWrapper">
      <div id="tableContainer"></div>
    </div>

    <script>
      const fileInput = document.getElementById("csvFile");
      const tableContainer = document.getElementById("tableContainer");

      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;

        Papa.parse(file, {
          header: true,
          dynamicTyping: true,
          complete: function (results) {
            const data = results.data;
            createTable(data);
          },
        });
      });

      function truncateText(text, maxLength = 20) {
        if (typeof text !== "string") text = String(text);
        return text.length > maxLength
          ? text.slice(0, maxLength) + "..."
          : text;
      }

      function createTable(data) {
        if (!data.length) return;
        const headers = Object.keys(data[0]);
        let html = "<table><thead><tr>";
        headers.forEach((h) => (html += `<th>${h}</th>`));
        html += "</tr></thead><tbody>";
        data.forEach((row) => {
          html += "<tr>";
          headers.forEach((h) => {
            const value = row[h] ?? "";
            const displayValue = truncateText(value);
            html += `<td title="${value}">${displayValue}</td>`;
          });
          html += "</tr>";
        });
        html += "</tbody></table>";
        tableContainer.innerHTML = html;
      }
    </script>
  </body>
</html>
